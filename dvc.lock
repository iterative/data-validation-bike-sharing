schema: '2.0'
stages:
  data_preparation:
    cmd: python stages/data_preparation.py --config=params.yaml
    deps:
    - path: stages/data_preparation.py
      md5: d974f9146200649a00fb56a0b18d6aca
      size: 3656
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        data_preparation:
          test_size: 0.33
          data_split: random
    outs:
    - path: data/bike-sharing/X_test.pkl
      md5: 76f70b4e4170803aa4e34ecac08b2129
      size: 77610
    - path: data/bike-sharing/X_train.pkl
      md5: 7479dbc78f55161d7a45e297704290ce
      size: 156170
    - path: data/bike-sharing/y_test.pkl
      md5: f65b28a8defe61fcafae427418340550
      size: 23879
    - path: data/bike-sharing/y_train.pkl
      md5: 013a76d74aac4b6bd9590aca7210960e
      size: 47447
  model_training:
    cmd: python stages/model_training.py --config=params.yaml
    deps:
    - path: data/bike-sharing/X_train.pkl
      md5: 7479dbc78f55161d7a45e297704290ce
      size: 156170
    - path: data/bike-sharing/y_train.pkl
      md5: 013a76d74aac4b6bd9590aca7210960e
      size: 47447
    - path: stages/model_training.py
      md5: 47bc08140d547d04ea0df1f6d2185c9d
      size: 1975
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        train:
          model_dir: models
          model_fname: ML_bike_sharing
          n_estimators: 50
    outs:
    - path: .mlem/model/ML_bike_sharing
      md5: 37db5d9bedcbae08b17e9832071f8991
      size: 7484077
    - path: .mlem/model/ML_bike_sharing.mlem
      md5: cd810a4ab2dfbcf7f6b800bd60bfa1a5
      size: 1800
  detector_training:
    cmd: python stages/detector_training.py --config=params.yaml
    deps:
    - path: data/bike-sharing/X_train.pkl
      md5: d0d8c896144fa3f99cdda66bcee6839a
      size: 173361
    - path: stages/detector_training.py
      md5: e1271dd49fc203069999787286b31b74
      size: 1138
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        detector:
          dir: models
          data_drift:
            fname: detector.joblib
          concept_drift:
            fname_working: cd_detector_wrk.joblib
            fname_noworking: cd_detector_nowrk.joblib
            latent_dim_working: 48
            latent_dim_noworking: 12
    outs:
    - path: models/detector.joblib
      md5: 577ef5967785b78179db35363041ef09.dir
      size: 155723
      nfiles: 2
  evaluation:
    cmd: python stages/evaluation.py --config=params.yaml
    deps:
    - path: .mlem/model/ML_bike_sharing
      md5: 37db5d9bedcbae08b17e9832071f8991
      size: 7484077
    - path: data/bike-sharing/X_test.pkl
      md5: 76f70b4e4170803aa4e34ecac08b2129
      size: 77610
    - path: data/bike-sharing/y_test.pkl
      md5: f65b28a8defe61fcafae427418340550
      size: 23879
    - path: models/covariate_shift_detector.joblib
      md5: e2a9a231006bd0b949c24f4bed722936.dir
      size: 140130
      nfiles: 2
    - path: stages/evaluation.py
      md5: b836d63f3b786f34d3b025deea0595a2
      size: 8346
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        detector:
          dir: models
          data_drift:
            fname: covariate_shift_detector.joblib
        evaluation:
          metrics_dir: metrics
          plots_dir: plots
        train:
          model_dir: models
          model_fname: ML_bike_sharing
          n_estimators: 50
    outs:
    - path: metrics/data_drift.json
      md5: b5b8060e045f6e5cfab6cd1281b8dc15
      size: 67
    - path: metrics/ml.json
      md5: c60776c1a7b90a5ed8efa9b79ef07b4d
      size: 87
    - path: plots/hum_feature_distribution.png
      md5: 349aa899fb78b3f0da91ec4a6ed7782f
      size: 43146
    - path: plots/temp_feature_distribution.png
      md5: 952ff81f20a717bbd82cd68575fc7d33
      size: 48500
  prediction_detector_training:
    cmd: python stages/prediction_drift_detector_training.py --config=params.yaml
    deps:
    - path: data/bike-sharing/X_train.pkl
      md5: 452c232628a5fb9f26d083a40f23a793
      size: 73742
    - path: models/pipe.joblib
      md5: d11e059c33fa055e9fad1eb67fc34d98
      size: 107367048
    - path: stages/prediction_drift_detector_training.py
      md5: 286e95577222a0cf077d2e4f6cdefd3d
      size: 1577
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        detector:
          detector_dir: models
          detector_fname: detector.joblib
          prediction_detector_dir: models
          prediction_detector_fname: prediction_detector.joblib
          detector_type: MMDDrift
        train:
          model_dir: models
          model_fname: pipe.joblib
          n_estimators: 50
    outs:
    - path: models/prediction_detector.joblib
      md5: 5b81f8f7dbd667926599a4684c9a21e2.dir
      size: 4360
      nfiles: 2
  concept_drift_detector_training:
    cmd: python stages/concept_drift_detector_training.py --config=params.yaml
    deps:
    - path: data/bike-sharing/X_cd_nowrk_train.npy
      md5: 440942f13a95288f69c852eccf7a50dd
      size: 17792
    - path: data/bike-sharing/X_cd_wrk_train.npy
      md5: 3e3a1670ebde469069ab7581ebc14ac5
      size: 37568
    - path: stages/concept_drift_detector_training.py
      md5: 9b75a4640af6b9e666c21db15f7a899c
      size: 2492
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        detector:
          dir: models
          data_drift:
            fname: detector.joblib
          concept_drift:
            fname_working: cd_detector_wrk.joblib
            fname_noworking: cd_detector_nowrk.joblib
            latent_dim_working: 48
            latent_dim_noworking: 12
    outs:
    - path: models/cd_detector_nowrk.joblib
      md5: 37eb7e2e4f19a85aeb57b2cc99b1f69a.dir
      size: 64095
      nfiles: 6
    - path: models/cd_detector_wrk.joblib
      md5: 33fad0052be9e3cbd3379f2e0197468f.dir
      size: 136796
      nfiles: 6
  covariate_drift_detector_training:
    cmd: python stages/covariate_drift_detector_training.py --config=params.yaml
    deps:
    - path: data/bike-sharing/X_train.pkl
      md5: 7479dbc78f55161d7a45e297704290ce
      size: 156170
    - path: stages/covariate_drift_detector_training.py
      md5: 037ee4a35c6253dbfb69247e800e6dd4
      size: 1435
    params:
      params.yaml:
        base:
          data_dir: data/bike-sharing
          data_fname: hour.csv
          random_state: 5
        detector:
          dir: models
          data_drift:
            fname: covariate_shift_detector.joblib
    outs:
    - path: models/covariate_shift_detector.joblib
      md5: e2a9a231006bd0b949c24f4bed722936.dir
      size: 140130
      nfiles: 2
